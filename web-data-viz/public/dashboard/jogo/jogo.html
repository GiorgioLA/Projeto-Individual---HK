<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="teste_jogo.css">
</head>div_nail
<body onkeyup="pararTotal(event)" onkeydown="mover_knight(event)" onload="carreguei()">
    <div class="main"></div>
    <div id="div_knight"></div>
    <div id="div_hornet"></div>
    <div id="div_casts">
        <div id="fireball"></div>
    </div>
    <div id="div_swing">
        <div id="swing"></div>
    </div>
    <div id="div_agulha"></div>
    <div id="div_harpao"></div>

    <div class="informacoes">
        Vida: <div id="div_hp">9</div>
        <!-- Vida Chefe: <div id="div_hp_hornet">800</div> -->
         <br>
        <div id="div_cooldown">Alma Sombria: pronta</div>
        <br>
        Tempo: <span id="tempo"></span> <br>
        <!-- Ativar Hornet <button id="ativar_chefe" style="display: none;" onclick="ativar_hornet()">Ativar</button> <br> -->
    </div>
    <div id="card" style="display: none;">
        <img class="dialogue" src="../../assets/images/top_dialogue_box-removebg-preview.png" alt="">
        <span>Bem vindo ao Protótipo da batalha contra um dos chefes do jogo: Hornet!</span>
        <span>Utilize os botões: W, A e D para se mover, Enter para atacar, Espaço para lançar um feitiço e Shift para esquivar</span>
        <button id="botao_comecar" onclick="comecar()">Comecar</button>
        <img class="dialogue" src="../../assets/images/bottom_dialogue_box-removebg-preview.png" alt="">
    </div>
</body>
</html>
<script>
    let timer = 0;
    let comecou = 'não'

    // FUNÇÕES DE INICIALIZAÇÃO ----------------------------------------------------------------------------------------------------------------------

    function carreguei() {
        bem_vindo()
        gravidade()
        check_still()
        div_knight.style.transform = `scaleX(-1)`
        // direita()
    }

    function comecar() {
        comecar_contagem()
        comecou = 'sim'
        card.style.display = 'none'
        // ativar_chefe.style.display  = 'flex'
        // function futura para "acordar" hornet
        ativar_hornet()

    }

    function bem_vindo() {
        card.style.display = 'flex'
        setTimeout (()=> botao_comecar.style.display = "flex", 1000)
    }

    function comecar_contagem() {
        if (parar_tempo == 1) return false
        timer+= 0.1
        let bingus = timer.toFixed(1)
        tempo.innerHTML = bingus;
        setTimeout(()=> comecar_contagem(), 100)
    }

    // DECLARANDO VARIÁVEIS ---------------------------------------------------------------------------------------------------------------------

    let d = 0;

    let global_top = 510;
    let global_left = 140;

    let unidade_medida = 'px';
    let checar_pulo = 0;
    let direcao = 2;
    let andandoR = 0;
    let pararR = 0;
    let andandoL = 0;
    let pararL = 0;

    let cont_fall = 1;
    let cont_walk = 1;
    
    let cooldown = 0;
    let lockout = 0;
    let posicao_fireball = 0;
    let direcao_fireball = 1;
    let cont_fireball = 1;
    let aux_mov_fireball = 0;
    let cont_animation = 0;

    let dash_cooldown = 0;
    let is_dashing = 0;
    let dash_lockout = 0;
    let cut_dash = 0

    let cooldown_nail = 0;
    let cont_swing = 0;
    let lockout_nail = 0;
    let direcao_swing = 1;
    let nail_duration = 0;
    let aux_nail_duration = 0;
    let soma_nail = 70;
    let apertando_dash = 0;

    let hp = 9;
    let hp_hornet = 600;
    let fim_boss = 0;

    let parar_tempo = 0

    let knight_info = div_knight.getBoundingClientRect();
    let hornet_info = div_hornet.getBoundingClientRect();
    let fireball_info = fireball.getBoundingClientRect();
    let needle_info = div_agulha.getBoundingClientRect();
    let swing_info = div_swing.getBoundingClientRect();

    // IMAGENS CAVALEIRO ------------------------------------------------------------------------------------------------------------------------ 
    
    const last_position = []
    const img_idle1 = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_idle_1.png">`;
    const img_fall1 = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_fall_1.png">`;
    const img_fall2 = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_fall_2.png">`;
    const img_fall3 = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_fall_3.png">`;
    const img_jump_1 = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_jump_1.png">`;
    const img_walk_1 =  `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_walk_1.png">`;
    const img_walk_2 =  `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_walk_2.png">`;
    const img_walk_3 =  `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_walk_3.png">`;
    const img_walk_4 =  `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_walk_4.png">`;
    const img_walk_5 =  `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_walk_5.png">`;
    const img_cast_1 =  `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_cast_1.png">`;
    const img_cast_2 =  `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_cast_2.png">`;
    const img_cast_3 =  `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_cast_3.png">`;
    const img_fireball_1 = `<img style="height: 90px;" src="../../assets/images/knight_sprite_sheet/knight_fireball_1.png">`;
    const img_fireball_2 = `<img style="height: 90px;" src="../../assets/images/knight_sprite_sheet/knight_fireball_2.png">`;
    const img_fireball_3 = `<img style="height: 90px;" src="../../assets/images/knight_sprite_sheet/knight_fireball_3.png">`;
    const img_fireball_4 = `<img style="height: 90px;" src="../../assets/images/knight_sprite_sheet/knight_fireball_4.png">`;
    const img_swing_1 = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_swing_1.png">`;
    const img_swing_2 = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_swing_2.png">`;
    const img_swing_3 = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_swing_3.png">`;
    const img_swing_4 = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_swing_4.png">`;
    const img_nail_1 = `<img src="../../assets/images/knight_sprite_sheet/knight_nail_1.png">`;
    const img_nail_2 = `<img src="../../assets/images/knight_sprite_sheet/knight_nail_2.png">`;
    const img_nail_3 = `<img src="../../assets/images/knight_sprite_sheet/knight_nail_3.png">`;
    const img_dash_1 = `<img src="../../assets/images/knight_sprite_sheet/knight_dash_1.png">`;
    const img_dash_2 = `<img src="../../assets/images/knight_sprite_sheet/knight_dash_2.png">`;
    const img_dash_3 = `<img src="../../assets/images/knight_sprite_sheet/knight_dash_3.png">`;
    const img_dmg_1 = `<img style='height: 100px;' src="../../assets/images/knight_sprite_sheet/knight_dmg_1.png">`;
    const img_dmg_2 = `<img style='height: 100px;' src="../../assets/images/knight_sprite_sheet/knight_dmg_2.png">`;

    // HORNET ------------------------------------------------------------------------------------------------------------------------------------

    const img_hornet_idle_1 = `<img class="style_hornet" src="../../assets/images/hornet_sprite_sheet/Hornet - idle0000.png">`;
    const img_hornet_start_1 = `<img style="height: 140px;" class="style_hornet" src="../../assets/images/hornet_sprite_sheet/hornet_start_1.png">`;
    const img_hornet_start_2 = `<img style="height: 170px;" class="style_hornet" src="../../assets/images/hornet_sprite_sheet/hornet_start_2.png">`;
    const img_hornet_start_3 = `<img style="height: 185px;" class="style_hornet" src="../../assets/images/hornet_sprite_sheet/hornet_start_3.png">`;
    const img_hornet_start_4 = `<img style="height: 155px;" class="style_hornet" src="../../assets/images/hornet_sprite_sheet/hornet_start_4.png">`;
    const img_hornet_start_5 = `<img class="style_hornet" src="../../assets/images/hornet_sprite_sheet/hornet_start_5.png">`;
    const img_hornet_start_6 = `<img style="height: 120px;" class="style_hornet" src="../../assets/images/hornet_sprite_sheet/hornet_start_6.png">`;
    const img_hornet_throw_1 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-throw_side0000.png">`;
    const img_hornet_throw_2 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-throw_side0001.png">`;
    const img_hornet_throw_3 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-throw_side0002.png">`;
    const img_hornet_throw_4 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-throw_side0003.png">`;
    const img_hornet_throw_5 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-throw_side0004.png">`;
    const img_hornet_throw_6 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-throw_side0005.png">`;
    const img_hornet_throw_7 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-throw_side0006.png">`;
    const img_hornet_throw_8 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-throw_side0007.png">`;
    const img_hornet_needle_1 = `<img class="style_hornet_needle" src="../../assets/images/hornet_sprite_sheet/hornet_needle_1.png">`;
    const img_hornet_needle_2 = `<img class="style_hornet_needle" src="../../assets/images/hornet_sprite_sheet/hornet_needle_2.png">`;
    const img_hornet_needle_3 = `<img class="style_hornet_needle" src="../../assets/images/hornet_sprite_sheet/hornet_needle_3.png">`;
    const img_hornet_harpoon_1 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-weapon-harpoon_thread_v020003.png">`;
    const img_hornet_harpoon_2 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-weapon-harpoon_thread_v020004.png">`;
    const img_hornet_harpoon_3 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-weapon-harpoon_thread_v020005.png">`;
    const img_hornet_harpoon_4 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-weapon-harpoon_thread_v020006.png">`;
    const img_hornet_harpoon_5 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-weapon-harpoon_thread_v020007.png">`;
    const img_hornet_harpoon_6 = `<img class="style_hornet_throw" src="../../assets/images/hornet_sprite_sheet/Hornet-weapon-harpoon_thread_v020008.png">`;
    const img_hornet_dash_1 = `<img class="style_hornet_dash" src="../../assets/images/hornet_sprite_sheet/hornet_dash_1.png">`;
    const img_hornet_dash_2 = `<img class="style_hornet_dash" src="../../assets/images/hornet_sprite_sheet/hornet_dash_2.png">`;
    const img_hornet_dash_3 = `<img style="height: 105px;" src="../../assets/images/hornet_sprite_sheet/hornet_dash_3.png">`;
    const img_hornet_dash_4 = `<img class="style_hornet_dash" src="../../assets/images/hornet_sprite_sheet/hornet_dash_4.png">`;
    const img_hornet_dash_6 = `<img class="style_hornet_dash" style="width: 150px;" src="../../assets/images/hornet_sprite_sheet/hornet_dash_6.png">`;
    const img_hornet_walk_1 = `<img class="style_hornet_walk" src="../../assets/images/hornet_sprite_sheet/hornet_walk_1.png">`;
    const img_hornet_walk_2 = `<img class="style_hornet_walk" src="../../assets/images/hornet_sprite_sheet/hornet_walk_3.png">`;
    const img_hornet_walk_3 = `<img class="style_hornet_walk" src="../../assets/images/hornet_sprite_sheet/hornet_walk_4.png">`;
    const img_hornet_walk_4 = `<img class="style_hornet_walk" src="../../assets/images/hornet_sprite_sheet/hornet_walk_5.png">`;

    let distancia_left_abs = 0;
    let distancia_top_abs = 0;
    let distancia_real_abs = 0;
    
    let distancia_left = 0;
    let direcao_hornet = 1;
    let posicao_agulha = 900;
    let atacando = 0;

    let hornet_left = 900;
    let hornet_top = 480;
    // let n_ataques = 99;
    div_hornet.innerHTML = img_hornet_idle_1; 

    function ativar_hornet() {
        // ativar_chefe.style.display = 'none';
        animacao_start_up(1);
    }

    function animacao_start_up(start_up) {
        hornet_info = div_hornet.getBoundingClientRect();
        knight_in_hornet()
        if (start_up == 1) {
            div_hornet.innerHTML = img_hornet_start_1;
            div_hornet.style.left = '850px'
            div_hornet.style.top = '480px'
            setTimeout(()=> animacao_start_up(2), 100) 
        } else if (start_up == 2) {
            div_hornet.innerHTML = img_hornet_start_2;
            div_hornet.style.left = '850px'
            div_hornet.style.top = '465px'
            setTimeout(()=> animacao_start_up(3), 100) 
        } else if (start_up == 3) {
            div_hornet.innerHTML = img_hornet_start_3;
            div_hornet.style.left = '850px'
            div_hornet.style.top = '465px'
            setTimeout(()=> animacao_start_up(4), 100) 
        } else if (start_up == 4) {
            div_hornet.innerHTML = img_hornet_start_4;
            div_hornet.style.left = '850px'
            div_hornet.style.top = '470px'
            setTimeout(()=> animacao_start_up(5), 100) 
        } else if (start_up == 5) {
            div_hornet.innerHTML = img_hornet_start_5;
            div_hornet.style.left = '850px'
            div_hornet.style.top = '480px'
            setTimeout(()=> animacao_start_up(6), 100) 
        } else if (start_up == 6) {
            div_hornet.innerHTML = img_hornet_start_6;
            div_hornet.style.left = '850px'
            div_hornet.style.top = '490px'
            setTimeout(() => div_hornet.innerHTML = img_hornet_idle_1  ,300)
            setTimeout(() => div_hornet.style.top = '480px',300)
            setTimeout(() => div_hornet.style.left = '900px',300)
            setTimeout(() => luta(2),350)

        }
    }
    function luta(n_ataques) {
        atacando = 0
        if (fim_boss == 1) return false
        if (n_ataques == 0) {
            n_ataques = (Math.random() * 3 + 0.5).toFixed(0)
            setTimeout(()=>andar_random(n_ataques),1000)
        }  else setTimeout(()=>atacar(n_ataques),1000)
    }

    function atacar(golpes) {
        distancia_left_abs = Math.abs(global_left - hornet_left);
        distancia_top_abs = Math.abs(global_top - hornet_top);
        distância_real_abs = (Math.pow(Math.pow(distancia_left_abs, 2) + Math.pow(distancia_top_abs, 2), 0.5)).toFixed(0)

        distancia_left = global_left - hornet_left;        
        
            let decidir_ataque = (Math.random() * 2 + 0.5).toFixed(0)
            atacando = 1
            if (decidir_ataque == 1) {
                ataque_perto_1(1, golpes)
                
            } else if (decidir_ataque == 2) {
                ataque_longo_1(1, golpes)
            }
        
    }

    // ANDAR ALEATÓRIO ------------------------------------------------------------------------------------------------------------

    function andar_random(params) {
        let posicao_aleatoria = Number((Math.random() * 800 + 140).toFixed(0))
        if (Math.abs(posicao_aleatoria - hornet_left) < 100) andar_random(params)
        else andar_hornet(posicao_aleatoria, 1, params)
    }

    function andar_hornet(limite, index, params) {
        if (index == 1) {
            distancia_left = limite - hornet_left;
            direcao_hornet = 1
            // index = index + 1
            if (distancia_left > 0) {
                div_hornet.style.transform = (`scaleX(-1)`)
                direcao_hornet = -1
            } else {
                div_hornet.style.transform = (`scaleX(+1)`)                
            }
        }
        if (index == 1 || index == 2) div_hornet.innerHTML = img_hornet_walk_1
        if (index == 3 || index == 4) div_hornet.innerHTML = img_hornet_walk_2
        if (index == 5 || index == 6) div_hornet.innerHTML = img_hornet_walk_3
        if (index == 7 || index == 8) div_hornet.innerHTML = img_hornet_walk_4
        if (index > 9 ) {
            div_hornet.innerHTML == img_walk_5
            index = 2
        }
        hornet_left -= 25 * direcao_hornet;
        div_hornet.style.left = `${hornet_left}px`
        hornet_info = div_hornet.getBoundingClientRect();
        knight_in_hornet()
        if (hornet_left < (limite - 50) || hornet_left > (limite + 50)) setTimeout(()=>andar_hornet(limite, index + 1, params),50)
        else {
            div_hornet.innerHTML = img_hornet_idle_1
            setTimeout(()=> luta(params), 500)
            atacando = 0
        }
    }

    // PULAR ALEATÓRIO ------------------------------------------------------------------------------------------------------------------------  


    // ATAQUES PERTO HORNET ------------------------------------------------------------------------------------------------------------------
    // ATAQUE PERTO 1 -----------

    function ataque_perto_1(perto_1, podeAtacar) {
        if (perto_1 == 1) {
            distancia_left = global_left - hornet_left;
            direcao_hornet = 1
            if (distancia_left > 0) {
                div_hornet.style.transform = (`scaleX(-1)`)
                direcao_hornet = -1
            } else {
                div_hornet.style.transform = (`scaleX(+1)`)
                direcao_hornet = 1                
            }
            // div_hornet.style.transform = (`scaleX(-1)`)
            div_hornet.style.top = '490px'
            div_hornet.innerHTML = img_hornet_dash_2
            setTimeout(()=>ataque_perto_1(2, podeAtacar),200)
        } else if (perto_1 == 2) {
            div_hornet.style.top = '500px'
            div_hornet.innerHTML = img_hornet_dash_4
            setTimeout(()=>ataque_perto_1(3, podeAtacar),500)
        } else if (perto_1 == 3) {
            div_hornet.innerHTML = img_hornet_dash_3
            setTimeout(()=>atacar_perto_1(1, podeAtacar),200)
            setTimeout(()=>div_hornet.innerHTML = img_hornet_dash_6,200)
        }
    }

    function atacar_perto_1(perto_1, podeAtacar) {
        if (perto_1 < 10) {
            div_hornet.style.top = '480px'
            if (hornet_left >= 40 && hornet_left <= 1080)hornet_left-= 50 * direcao_hornet
            else if (hornet_left < 40) {
                hornet_left = 40
                div_hornet.style.left = `${hornet_left}px`
                hornet_info = div_hornet.getBoundingClientRect();
                knight_in_hornet()
            }
            else if (hornet_left > 1080){
                hornet_left = 1080
                div_hornet.style.left = `${hornet_left}px`
                hornet_info = div_hornet.getBoundingClientRect();
                knight_in_hornet()
            }
            div_hornet.style.left = `${hornet_left}px`
            hornet_info = div_hornet.getBoundingClientRect();
            knight_in_hornet()
            setTimeout(()=>atacar_perto_1(perto_1 + 1, podeAtacar),40)
        } else {
            div_hornet.style.top = '480px'
            div_hornet.innerHTML = img_hornet_idle_1
            setTimeout(()=>luta(podeAtacar - 1), 1000)
            atacando = 0
        }
    }

    // ATAQUES LONGOS HORNET -----------------------------------------------------------------------------------------------------------------
    // ATAQUE LONGO 1 -----------

    function ataque_longo_1(longo_1, podeAtacar) {
        console.log(podeAtacar)
        if (longo_1 == 1){
            div_harpao.style.left = `${hornet_left - 550}px`;
            div_harpao.style.top = `${hornet_top}px`;
            posicao_agulha = hornet_left;
            setTimeout(()=> agulha_longo_1(1, podeAtacar) ,900)
            distancia_left = global_left - hornet_left;
            direcao_hornet = 1
            div_agulha.style.width= '100px'
            div_agulha.style.height = '20px'
            needle_info = div_agulha.getBoundingClientRect();
            needle_in_knight()
        }
        if (distancia_left > 0) {
            div_hornet.style.transform = (`scaleX(-1)`)
            div_harpao.style.transform = (`scaleX(-1)`)
            div_agulha.style.transform = (`scaleX(-1)`)
            direcao_hornet = -1;
            div_harpao.style.left = `${hornet_left + 50}px`;  
            needle_info = div_agulha.getBoundingClientRect();
            needle_in_knight()
        }
        else{
            div_hornet.style.transform = (`scaleX(+1)`)
            div_harpao.style.transform = (`scaleX(+1)`)
            div_agulha.style.transform = (`scaleX(+1)`)
            needle_info = div_agulha.getBoundingClientRect();
            needle_in_knight()
        }
        if (longo_1 == 1) {
            div_hornet.innerHTML = img_hornet_throw_1
            setTimeout(()=> ataque_longo_1(2, podeAtacar) ,300)
        } else if (longo_1 == 2) {
            div_hornet.innerHTML = img_hornet_throw_2
            setTimeout(()=> ataque_longo_1(3, podeAtacar) ,300)
        } else if (longo_1 == 3) {
            div_hornet.innerHTML = img_hornet_throw_3
            setTimeout(()=> ataque_longo_1(4, podeAtacar) ,300)
        } else if (longo_1 == 4) {
            div_hornet.innerHTML = img_hornet_throw_4
            div_harpao.innerHTML = img_hornet_harpoon_1
            div_agulha.style.left = `${hornet_left}px`;
            div_agulha.style.top = `${hornet_top + 60}px`;
            setTimeout(()=> ataque_longo_1(5, podeAtacar) ,100)
        } else if (longo_1 == 5) {
            div_hornet.innerHTML = img_hornet_throw_5
            div_harpao.innerHTML = img_hornet_harpoon_2
            setTimeout(()=> ataque_longo_1(6, podeAtacar) ,100)
        } else if (longo_1 == 6) {
            div_hornet.innerHTML = img_hornet_throw_6
            div_harpao.innerHTML = img_hornet_harpoon_3
            setTimeout(()=> ataque_longo_1(7, podeAtacar) ,100)
        } else if (longo_1 == 7) {
            div_hornet.innerHTML = img_hornet_throw_7
            div_harpao.innerHTML = img_hornet_harpoon_4
            setTimeout(()=> ataque_longo_1(8, podeAtacar) ,100)
        } else if (longo_1 == 8) {
            div_hornet.innerHTML = img_hornet_throw_8
            div_harpao.innerHTML = img_hornet_harpoon_5
            div_agulha.innerHTML = img_hornet_needle_2
            setTimeout(()=> loop_longo_1(10, 1, podeAtacar) ,100)
        }
    }

    function agulha_longo_1(parametro_agulha_L1) {
        let aux = parametro_agulha_L1;
        if (aux < 24) {
            div_agulha.innerHTML = img_hornet_needle_1;
            posicao_agulha = posicao_agulha - 26 * direcao_hornet 
            div_agulha.style.left = `${posicao_agulha}px`
            needle_info = div_agulha.getBoundingClientRect();
            needle_in_knight()
            setTimeout(()=>agulha_longo_1(aux + 1), 25)
        }
    }

    function voltar_agulha_1(parametro_voltar_agulha_L1) {
        let aux = parametro_voltar_agulha_L1;
        if (aux < 18) {
            div_agulha.innerHTML = img_hornet_needle_1;
            posicao_agulha = posicao_agulha + 26 * direcao_hornet 
            div_agulha.style.left = `${posicao_agulha}px`
            needle_info = div_agulha.getBoundingClientRect();
            needle_in_knight()
            setTimeout(()=>voltar_agulha_1(aux + 1), 25)
        } else {
            div_agulha.style.width = '0'
            div_agulha.style.height = '0'
            div_agulha.innerHTML = ''
            div_agulha.style.left = '-100px'
            div_agulha.style.height = '-100px'
            needle_info = div_agulha.getBoundingClientRect();
            needle_in_knight()
            // luta(podeAtacar - 1)
        }
    }

    function loop_longo_1(total, frame_atual, podeAtacar) {
        if (total > 0) {
            if (frame_atual == 1){
                div_hornet.innerHTML = img_hornet_throw_7
                setTimeout(()=> loop_longo_1(total - 1, 2, podeAtacar) ,100)
            } else if (frame_atual == 2){
                div_hornet.innerHTML = img_hornet_throw_8
                setTimeout(()=> loop_longo_1(total - 1, 3, podeAtacar) ,100)
            } else if (frame_atual == 3){
                div_hornet.innerHTML = img_hornet_throw_6
                setTimeout(()=> loop_longo_1(total - 1, 1, podeAtacar) ,100)
            }
        } else {
            setTimeout(()=> voltar_agulha_1(1), 200)
            voltar_longo_1(1, podeAtacar)
        }
    }

    function voltar_longo_1(param_voltar_L1, podeAtacar) {
        let aux = param_voltar_L1;
        if (aux == 1) {
            div_hornet.innerHTML = img_hornet_throw_5;
            div_harpao.innerHTML = img_hornet_harpoon_4;
            setTimeout(()=> voltar_longo_1(2, podeAtacar),100);
        } else if (aux == 2) {
            div_hornet.innerHTML = img_hornet_throw_4;
            div_harpao.innerHTML = img_hornet_harpoon_3;
            setTimeout(()=> voltar_longo_1(3, podeAtacar),100);
        } else if (aux == 3) {
            div_hornet.innerHTML = img_hornet_throw_3;
            div_harpao.innerHTML = img_hornet_harpoon_2;
            setTimeout(()=> voltar_longo_1(4, podeAtacar),100);
        } else if (aux == 4) {
            div_hornet.innerHTML = img_hornet_throw_2;
            div_harpao.innerHTML = img_hornet_harpoon_1;
            setTimeout(()=> voltar_longo_1(5, podeAtacar),100);
        } else if (aux == 5) {
            div_hornet.innerHTML = img_hornet_throw_1;
            div_harpao.innerHTML = '';
            setTimeout(()=> voltar_longo_1(6, podeAtacar),100);
        } else {
            div_hornet.innerHTML = img_hornet_idle_1
            // if (n_ataques > 0) setTimeout(()=> atacar(),400)
                setTimeout(()=> luta(podeAtacar - 1),1000)
                atacando = 0
                console.log(podeAtacar, podeAtacar - 1)
        }
    }

    // MOVER CAVALEIRO (SEM HITBOX) -----------------------------------------------------------------------------------------------

    function mover_knight(event) {
        if (lockout >= 1 || comecou == 'não' || fim_boss == 1) return false
        console.log("PARÂMETRO DO EVENTO DISPARADO: ", event,"TEMPO ATUAL:", timer.toFixed(3));
        if (event.key == "w" && global_top == 510 && checar_pulo == 0) pular()
        else if (event.key == "a" && global_left > 40 && lockout == 0){
            if (andandoL == 0 ) esquerda()
            andandoL = 1
        }
        else if (event.key == "d" && global_left < 1080 && lockout == 0) {
            if (andandoR == 0) direita()
            andandoR = 1
        }
        else if (event.key == ' ' && cooldown == 0 && dash_lockout == 0) cast_fireball()
        else if (event.key == 'Enter' && cooldown_nail == 0) swing_nail()
        else if (event.key == 'Shift' && lockout == 0 && dash_cooldown == 0 && is_dashing == 0 && dash_lockout == 0) {
            if (apertando_dash == 0){
            apertando_dash = 1;
            lockout = 2;
            dash_cooldown = 1;
            dash_lockout = 1
            checar_pulo = 1;
            is_dashing = 1;
            pararR = 1;
            pararL = 1
            andandoL = 0
            setTimeout(()=> pararL = 0, 35)
            pararR = 1
            andandoR = 0
            setTimeout(()=> pararR = 0, 35)
            start_dash();
            animacao_dash(1);
            setTimeout (()=> lockout = 0, 450)
            setTimeout (()=> pararR = 0, 450)
            setTimeout (()=> dash_lockout = 0, 800)
            setTimeout (()=> apertando_dash = 0, 800)
            setTimeout (()=> dash_cooldown = 0, 400)}
        }
        
        div_knight.style.top = `${global_top}${unidade_medida}`;
        div_knight.style.left = `${global_left}${unidade_medida}`;
        knight_info = div_knight.getBoundingClientRect()
        knight_in_hornet()
    }

    function pararTotal() {
    if (event.key == 'a'){
        pararL = 1
        andandoL = 0
        setTimeout(()=> pararL = 0, 35)
    }
    if (event.key == 'd'){
        pararR = 1
        andandoR = 0
        setTimeout(()=> pararR = 0, 35)
    }
    if (event.key == 'Shift'){
        pararR = 1
        andandoR = 0
        setTimeout(()=> pararR = 0, 35)
        pararL = 1
        andandoL = 0
        setTimeout(()=> pararL = 0, 35)
    }
    }

    function esquerda() {
            if (global_left > 40 && is_dashing == 0)global_left -= 13;
            div_knight.style.left = `${global_left}${unidade_medida}`;        
            if(pararL == 1 || lockout == 1) return false
            walk()
            if (direcao == 2 && lockout_nail == 0) {
                flipLeft()
                direcao = 1
            } else {
                walk()
            }
            setTimeout (()=> esquerda(), 35)
            }

    function direita() { 
        if (global_left < 1080 &&  is_dashing == 0)global_left += 13;
            div_knight.style.left = `${global_left}${unidade_medida}`;    
            if(pararR == 1 || lockout == 1) return false
            walk()
            setTimeout (()=> direita(), 35)
            if (direcao == 1 && lockout_nail == 0) {
                flipRight()
                direcao = 2
            } else {
                walk()
            }
    }

    function flipRight() {
        div_knight.style.transform = `scaleX(-1)`
        soma_nail = 70
    }

    // Inverter direção(2)

    function flipLeft() {
        div_knight.style.transform = `scaleX(+1)`
        soma_nail = -140
    }

    function walk() {

    if (checar_pulo == 0 && lockout_nail == 0 && global_top == 510) {
        if (cont_walk == 1 || cont_walk == 2) {
            div_knight.innerHTML = img_walk_1
            cont_walk++
        } else if (cont_walk == 3 || cont_walk == 4) {
            div_knight.innerHTML = img_walk_3
            cont_walk++
        } else if (cont_walk == 5 || cont_walk == 6) {
            div_knight.innerHTML = img_walk_2
            cont_walk++
        } else if (cont_walk == 7 || cont_walk == 8) {
            div_knight.innerHTML = img_walk_3
            cont_walk++
        } else if (cont_walk == 9 || cont_walk == 10) {
            div_knight.innerHTML = img_walk_4
            cont_walk++
        } else if (cont_walk == 11) {
            div_knight.innerHTML = img_walk_5
            cont_walk++
        } else if (cont_walk == 12) {
            cont_walk = 1
        }
    }
    }

    // DASH CAVALEIRO -------------------------------------------------------------------------------------------------

    function start_dash() {
        if (global_left > 40 && global_left < 1080 && cut_dash == 0) {
            let direcao_dash = -1;
            if (direcao == 2) direcao_dash = 1;
            global_left += 35 * direcao_dash
            div_knight.style.left = `${global_left}px`
            knight_info = div_knight.getBoundingClientRect()
        knight_in_hornet()
            }
        if (dash_cooldown == 1) setTimeout(()=> start_dash(),50)
        else is_dashing = 0;
    }

    function animacao_dash(parametro_dash) {
        if (cut_dash == 1) return false
        if (parametro_dash == 1) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_dash_1.png">`;
            setTimeout(()=> animacao_dash(2), 40)
        } else if (parametro_dash == 2) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_dash_1.png">`;
            setTimeout(()=> animacao_dash(3), 40)
        }  else if (parametro_dash == 3) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_dash_1.png">`;
            setTimeout(()=> animacao_dash(4), 40)
        }  else if (parametro_dash == 4) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_dash_2.png">`;
            setTimeout(()=> animacao_dash(5), 40)
        }  else if (parametro_dash == 5) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_dash_2.png">`;
            setTimeout(()=> animacao_dash(6), 40)
        }  else if (parametro_dash == 6) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_dash_2.png">`;
            setTimeout(()=> animacao_dash(7), 40)
        }  else if (parametro_dash == 7) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_dash_2.png">`;
            setTimeout(()=> animacao_dash(8), 40)
        }  else if (parametro_dash == 8) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_dash_2.png">`;
            setTimeout(()=> animacao_dash(9), 40)
        }  else if (parametro_dash == 9) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_dash_3.png">`;
            setTimeout(()=> animacao_dash(10), 40)
        }  else if (parametro_dash == 10) {
            div_knight.innerHTML = `<img class="style_knight" src="../../assets/images/knight_sprite_sheet/knight_idle_1.png">`;
        }
    }

    // GRAVIDADE E PULO -----------------------------------------------------------------------------------------------

    function gravidade() {
        if(global_top < 510 && checar_pulo == 1 ) {
            if (lockout == 0 && cut_dash == 0) global_top += 10
            fall_cycle()
        }
        else if (global_top == 510) {
            if (checar_pulo == 1) div_knight.innerHTML = img_idle1
            checar_pulo = 0 
        }
        div_knight.style.top = `${global_top}${unidade_medida}`;
        knight_info = div_knight.getBoundingClientRect()
        knight_in_hornet()
        setTimeout(() => gravidade() ,20);
    }

    function fall_cycle() {
        if (lockout == 0 && lockout_nail == 0){
        if (cont_fall == 1 || cont_fall == 2) {
            cont_fall++;
            div_knight.innerHTML = img_fall3
        } else if (cont_fall == 3 || cont_fall == 4) {
            cont_fall++
            div_knight.innerHTML = img_fall3;
        }  else if (cont_fall == 5) {
            cont_fall = 1
        }}
    }

    function pular() {
        if (lockout == 0 && lockout_nail == 0)div_knight.innerHTML = img_jump_1
        // checar_pulo = 0.5    
        if (lockout == 0) global_top-= 10;
        if (global_top <= 290) setTimeout(() => checar_pulo = 1 ,100);
        else if (checar_pulo < 1) setTimeout(() => pular() ,15);
    }

    // CHECAR SE ESTÁ PARADO -----------------------------------------------------------------------------------------------------------------------

    function check_still() {
        last_position.push(global_left)

        if ((global_left[last_position.lenght] == global_left[last_position.length - 3]) && checar_pulo == 0 && lockout_nail == 0 && is_dashing == 0 && cut_dash == 0) {
            div_knight.innerHTML = img_idle1
        }
    setTimeout(() => check_still() ,1000);
    }

    // ESPADA (SEM HITBOX) -------------------------------------------------------------------------------------------------------------------------

    function swing_nail() {
        cooldown_nail = 1;
        lockout_nail = 1;
        swing_animation()
        swing_fnc()
    }

    function swing_animation() {
        if (cont_swing == 0) {
            div_knight.innerHTML = img_swing_1
            cont_swing++
        } else if (cont_swing == 1) {
            div_knight.innerHTML = img_swing_4
            cont_swing++
        // } else if (cont_swing == 2) {
        //     div_knight.innerHTML = img_swing_2
        //     cont_swing++
        } else if (cont_swing == 2) {
            div_knight.innerHTML = img_swing_3
            cont_swing = 0;
            lockout_nail = 0;
            setTimeout(() => cooldown_nail = 0, 250);
            setTimeout(() => div_knight.innerHTML = img_idle1 ,50);

            return false
        }
        
        setTimeout(() => swing_animation(),150);
    }

    function swing_fnc() {
        direcao_swing = -1;
        if (direcao == 2) direcao_swing = 1;
         
        div_swing.innerHTML = `<div id="swing">
            ${img_nail_1}
            </div>`

        if (direcao == 2) {
            swing.style.transform = `scaleX(-1)`
            div_swing.style.left = `${global_left + soma_nail}px`
            div_swing.style.top = `${global_top}px`
            swing_info = div_swing.getBoundingClientRect();
            nail_in_hornet(21)
            // posicao_div_swing = Number(global_left)
        } else {
            div_swing.style.left = `${global_left + soma_nail}px`
            div_swing.style.top = `${global_top}px`
            swing_info = div_swing.getBoundingClientRect();
            nail_in_hornet(21)
            // posicao_div_swing = Number(global_left)
        }
        nail_duration = 2
        setTimeout(() => follow_knight(),50);
        // div_swing.style.left = `${global_left + 100 * direcao_swing}px`
    }

    function follow_knight() {
        div_swing.style.top = `${global_top}px`
        div_swing.style.left = `${global_left + soma_nail}px`
        swing_info = div_swing.getBoundingClientRect()
        nail_in_hornet(21)
        if (aux_nail_duration == 0) {
            aux_nail_duration++
        } else if (aux_nail_duration == 1) {
            aux_nail_duration++
        } else if (aux_nail_duration == 2) {
            nail_in_hornet(21)
            aux_nail_duration = 0;
            div_swing.innerHTML = ``
            div_swing.style.left = '-100px'
            div_swing.style.top = '-100px'
            swing_info = div_swing.getBoundingClientRect()
            return false
        }
        // nail_duration--
        setTimeout(() => follow_knight(),80);
    }

    // BOLA DE "FOGO" (SEM HITBOX) -----------------------------------------------------------------------------------------------------------

    function cast_fireball() {
        lockout = 1;
        cooldown = 5;
        cooldown_fireball()
        cast_animation()
        setTimeout(() => 
        cast()
        // lockout = 0
        ,300);
    }

    function cast_animation() {
        if (cont_animation == 0) {
            cont_animation++
            div_knight.innerHTML = img_cast_1
        } else if (cont_animation == 1) {
            cont_animation++
            div_knight.innerHTML = img_cast_2
        } else if (cont_animation == 2) {
            cont_animation++
            div_knight.innerHTML = img_cast_3
        }
        if (cont_animation == 3) {
            cont_animation = 0
            div_knight.innerHTML = img_idle1
            return false
        }
        setTimeout(() => cast_animation(),100);
    }

    function cast() {
        direcao_fireball = 1;
        if (direcao == 2) direcao_fireball = -1; 
        lockout = 0
        div_casts.innerHTML = `<div id="fireball">
            ${img_fireball_1}
            </div>`
        fireball.style.top = `${global_top -10}px`
        fireball_info = fireball.getBoundingClientRect();
        fireball_in_hornet()
        if (direcao == 2) {
            fireball.style.transform = `scaleX(-1)`
            fireball.style.left = `${global_left}px`
            fireball_info = fireball.getBoundingClientRect();
            fireball_in_hornet()
            posicao_fireball = Number(global_left)
        } else {
            fireball.style.left = `${global_left}px`
            fireball_info = fireball.getBoundingClientRect();
            fireball_in_hornet()
            posicao_fireball = Number(global_left)
        }
        fireball_info = fireball.getBoundingClientRect();
        fireball_in_hornet()
        move_fireball(direcao_fireball)
    }

    function move_fireball(e) {
        if (aux_mov_fireball == 0) d = Number(e)
        // alert(d)
        // alert(posicao_fireball)
        // alert(global_left)
        if (posicao_fireball > 0 && posicao_fireball < 1080) {
            posicao_fireball = posicao_fireball - 50 * d
            // alert(posicao_fireball)
            fireball.style.left = `${posicao_fireball}px`
            fireball_info = fireball.getBoundingClientRect();
            fireball_in_hornet()
            if (cont_fireball == 1) {
                fireball.innerHTML = img_fireball_2
                cont_fireball = 2
            } else if (cont_fireball == 2) {
                fireball.innerHTML = img_fireball_3
                cont_fireball = 3
            } else if (cont_fireball == 3) {
                fireball.innerHTML = img_fireball_4
                cont_fireball = 1
            }

            aux_mov_fireball = 1;
            setTimeout(() => move_fireball(),100);
        } else {
            aux_mov_fireball = 0
            fireball.innerHTML = ``
            fireball.style.left = '-100px'
            fireball.style.top = '-100px'
            fireball_info = fireball.getBoundingClientRect();
            fireball_in_hornet()
        }
    }

    function cooldown_fireball() {
        cooldown--
        div_cooldown.innerHTML = `Alma Sombria: <div>${cooldown}</div>`
        if(cooldown > 0) setTimeout(() => cooldown_fireball(),1000);
        else div_cooldown.innerHTML = `Alma Sombria: pronta`

    }

    // HORNET (SEM HITBOX) ---------------------------------------------------------------------------------------------------------------------------



    // HITBOX ----------------------------------------------------------------------------------------------------------------------------------------

    let teste = false

    let bateu_esquerda = false;
    let bateu_direita = false;
    let bateu_cima = false;
    let bateu_baixo = false;    

    let buffer = 0;
    let buffer2 = 0;

    // knight_in_hornet()
    function knight_in_hornet() {
        // console.log('hello')
        bateu_esquerda = knight_info.right > hornet_info.left 
        bateu_direita = knight_info.left < hornet_info.right 
        bateu_cima = knight_info.bottom > hornet_info.top 
        bateu_baixo = knight_info.top < hornet_info.bottom 

        if (bateu_direita && bateu_cima && bateu_baixo && bateu_esquerda) {
            if (buffer == 0 && fim_boss == 0) tomar_dano()
        }
        // else teste = false
        // setTimeout(()=> knight_in_hornet(), 10)
    }

    function needle_in_knight() {
        bateu_esquerda = knight_info.right > needle_info.left 
        bateu_direita = knight_info.left < needle_info.right 
        bateu_cima = knight_info.bottom > needle_info.top 
        bateu_baixo = knight_info.top < needle_info.bottom 

        if (bateu_direita && bateu_cima && bateu_baixo && bateu_esquerda) {
            if (buffer == 0 && fim_boss == 0) tomar_dano()
        }
        // else teste = false
    }

    function nail_in_hornet() {
        bateu_esquerda = swing_info.right > hornet_info.left 
        bateu_direita = swing_info.left < hornet_info.right 
        bateu_cima = swing_info.bottom > hornet_info.top 
        bateu_baixo = swing_info.top < hornet_info.bottom 

        if (bateu_direita && bateu_cima && bateu_baixo && bateu_esquerda) {
            if (buffer2 == 0 && fim_boss == 0) causar_dano(21)
        }
    }

    function fireball_in_hornet() {
        bateu_esquerda = fireball_info.right > hornet_info.left 
        bateu_direita = fireball_info.left < hornet_info.right 
        bateu_cima = fireball_info.bottom > hornet_info.top 
        bateu_baixo = fireball_info.top < hornet_info.bottom 

        if (bateu_direita && bateu_cima && bateu_baixo && bateu_esquerda) {
            if (buffer2 == 0 && fim_boss == 0) causar_dano(60)
        }
    }

    function tomar_dano() {
        if (buffer == 0) {
            buffer = 1;
            setTimeout(()=> buffer = 0 ,2000)
            hp--
            div_hp.innerHTML = hp
            if (hp >= 1) animacao_tomar_dano(1)
            else acabar(1)
        } 
    }

    function animacao_tomar_dano(parms) {
            lockout = 1;
            cut_dash = 1;
            let direcao_knock = 1;
            if (direcao == 2) direcao_knock = -1;
            global_left += 20 * direcao_knock
            div_knight.style.left = `${global_left}px`
        if (parms == 1){
            setTimeout(()=> animacao_tomar_dano(2),150)
            div_knight.innerHTML = img_dmg_1;
        } else if (parms == 2) {
            div_knight.innerHTML = img_dmg_2;
            setTimeout(()=> animacao_tomar_dano(3),150)
        } else if (parms == 3) {
            lockout = 0;
            cut_dash = 0;
        }
        // else is_dashing = 0;
    }

    function causar_dano(dano) {
        buffer2 = 1;
        console.log(dano)
        hp_hornet = hp_hornet - dano;
        setTimeout(()=> buffer2 = 0 ,600)
        // div_hp_hornet.innerHTML = hp_hornet
        if (atacando == 0) empurrar_hornet(1)
        feedback_hit(20)
        if (hp_hornet <= 0) {
            setTimeout(()=> acabar(2), 100)
            hp_hornet = 0
        }
    }

    let opacity = 100;
    function feedback_hit(param) {
        if (param >= 10) {
            opacity = opacity - 5
            div_hornet.style.opacity = `${opacity}%`
            setTimeout(()=> feedback_hit(param - 1) ,10)
        } else if (param >= 0) {
            opacity = opacity + 5
            div_hornet.style.opacity = `${opacity}%`
            setTimeout(()=> feedback_hit(param - 1) ,10)
        } else {
            opacity = 100;
            div_hornet.style.opacity = `${opacity}%`
        }
    }

    function empurrar_hornet(param) {
        let mult = 1
        if (direcao == 2) mult = -1;
        if(hornet_left >= 40 && hornet_left <= 1080)hornet_left = hornet_left - 10 * mult
        else if (hornet_left < 40) hornet_left = 40
        else hornet_left = 1080
        div_hornet.style.left = `${hornet_left}px`
        hornet_info = div_hornet.getBoundingClientRect()
        if (param <= 3) setTimeout(() => {
            empurrar_hornet(param+1)
        }, 100);
    } 

    function acabar(param) {
        fim_boss = 1
        parar_tempo = 1
        card.innerHTML = ''
        if (param == 1) {
            card.style.display = 'flex'
            card.innerHTML = `
                <img class="dialogue" src="../../assets/images/top_dialogue_box-removebg-preview.png" alt="">
                <span>Você foi eliminado!</span>
                <span>Você pode voltar ao site ou tentar novamente.</span>
                <button onclick="Voltar(1)" class="botoes">Voltar</button>
                <button onclick="Voltar(2)" class="botoes">Tentar Novamente</button>
                <img class="dialogue" src="../../assets/images/bottom_dialogue_box-removebg-preview.png" alt="">
            `
        } else {
            card.style.display = 'flex'
            card.innerHTML = `
                <img class="dialogue" src="../../assets/images/top_dialogue_box-removebg-preview.png" alt="">
                <span>Você consegui vencer da Hornet!</span>
                <span>Clique em 'Voltar' para registrar sua tentativa! Você ainda pode jogar novamente.</span>
                <button onclick="Voltar(3)" class="botoes">Voltar</button>
                <img class="dialogue" src="../../assets/images/bottom_dialogue_box-removebg-preview.png" alt="">
            `
        }
    }

    function Voltar(param) {
        if (param == 1) window.location = '../areas/kingdoms_edge.html'
        if (param == 2) window.location.reload()
        if (param == 3) {

        let dmg_taken = 9 - Number(hp);
        

        fetch("/usuarios/registrarVitoria", {
            method: "POST",
            headers: {
        "Content-Type": "application/json",
        },
        body: JSON.stringify({
        idUserServer: sessionStorage.ID_USUARIO,
        timerServer: timer,
        danoServer: dmg_taken
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {

          alert('Cadastrado com sucesso! Redirecionando...')

          setTimeout(() => {
                 window.location = '../areas/kingdoms_edge.html'
            }, 1000);   

        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
          return false
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
        }
    }


    // function


</script>